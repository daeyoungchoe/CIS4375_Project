var fs=require("fs"),superagent=require("superagent"),dotenv=require("dotenv"),MODE_0666=parseInt("0666",8);module.exports={isTurboApp:function(){var e=null,n=null;try{e=fs.readFileSync("package.json","utf8");var r=JSON.parse(e),t=r.dependencies;if(null==t.turbo360||null==t.vertex360)return{isTurboApp:!1,missing:"turbo360 and/or vertex 360",reason:"Missing turbo360 and/or vertex 360 dependencies"};var i=fs.readFileSync(".env","utf8");n=dotenv.parse(i);var o=n.TURBO_ENV;return null==o?{isTurboApp:!1,missing:"TURBO_ENV environment variable",reason:'Missing TURBO_ENV environment variable. Please set "TURBO_ENV=dev" in the .env file'}:{isTurboApp:!0,turboEnv:o,turbo360:t.turbo360,vertex360:t.vertex360}}catch(n){var s=null==e?"package.json":".env",u=null==e?"Missing package.json file":'Missing .env file. Please add .env file with "TURBO_ENV=dev" variable set.';return{isTurboApp:!1,missing:s,reason:u}}},defaultTurboDeploy:function(){var e="## Do NOT check this file into version control\n";return e+="\nBUCKET=<AWS_HOST_BUCKET>",e+="\nAWS_KEY=<AWS_KEY>",e+="\nAWS_SECRET=<AWS_SECRET>",e+="\nAWS_ACCT=<AWS_ACCT>",e+="\nAWS_ROLE=<AWS_ROLE>",e+="\nAWS_REGION=<AWS_REGION>"},defaultEnv:function(){var e="## Do NOT check this file into version control\n";return e+="\nTURBO_ENV=dev",e+="\nTURBO_CDN=https://cdn.turbo360-vertex.com",e+="\nSESSION_SECRET=YOUR_SESSION_SECRET",e+="\nTURBO_APP_ID=<TURBO_APP_ID>",e+="\nTMP_DIR=/tmp",e+="\nTURBO_API_KEY=<TURBO_API_KEY>",e+="\nTURBO_APP_SLUG=<TURBO_APP_SLUG>"},validateEnv:function(e,n){n||(n=[{text:"TURBO_CDN",min:20,placeholder:"https://cdn.turbo360-vertex.com"},{text:"TURBO_APP_SLUG",min:6,placeholder:"<TURBO_APP_SLUG>"},{text:"TURBO_API_KEY",min:20,placeholder:"<TURBO_API_KEY>"},{text:"TURBO_APP_ID",min:20,placeholder:"<TURBO_APP_ID>"}]);var r=null;return n.forEach(function(n){var t=n.text;return null==e[t]?void(r=t):e[t]==n.placeholder?void(r=t):e[t].length<n.min?void(r=t):void 0}),r},write:function(e,n,r){fs.writeFileSync(e,n,{mode:r||MODE_0666})},readFile:function(e,n){return new Promise(function(r,t){fs.readFile(e,"utf8",function(e,i){if(e){var o=n?Error(n):e;return void t(o)}r(i)})})},readFileSync:function(e,n){n||(n="utf8");try{return fs.readFileSync(e,n)}catch(e){return null}},postRequest:function(e,n){return new Promise(function(r,t){superagent.post(e).send(n).set("Accept","application/json").end(function(e,n){if(e){if(!n)return void t(e);if(n.text)try{var i=JSON.parse(n.text),o=i.message||"Something went wrong. Please try again.";return void t(new Error(o))}catch(e){}return void t(e)}if("success"!=n.body.confirmation)return void t(new Error(n.body.message));r(n.body)})})},putRequest:function(e,n){return new Promise(function(r,t){superagent.put(e).send(n).set("Accept","application/json").end(function(e,n){if(e){if(!n)return void t(e);if(n.text)try{var i=JSON.parse(n.text),o=i.message||"Something went wrong. Please try again.";return void t(new Error(o))}catch(e){}return void t(e)}if("success"!=n.body.confirmation)return void t(new Error(n.body.message));r(n.body)})})},getRequest:function(e){return new Promise(function(n,r){superagent.get(e).set("Accept","application/json").end(function(e,t){if(e){if(!t)return void r(e);if(t.text)try{var i=JSON.parse(t.text),o=i.message||"Something went wrong. Please try again.";return void r(new Error(o))}catch(e){}return void r(e)}if("success"!=t.body.confirmation)return void r(new Error(t.body.message));n(t.body)})})}};